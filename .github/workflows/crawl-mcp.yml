name: "Manual: Crawl MCP Registries"

on:
  workflow_dispatch:
    inputs:
      registry:
        description: "Registry to crawl"
        required: true
        type: choice
        options:
          - mcp-registry
          - mcp-so
          - lobehub

jobs:
  crawl:
    runs-on: ubuntu-latest
    timeout-minutes: 120

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: pip

      - run: pip install -r requirements.txt

      - name: Restore crawl cache
        uses: actions/cache@v4
        with:
          path: data/${{ inputs.registry }}/
          key: ${{ inputs.registry }}-${{ github.run_number }}
          restore-keys: |
            ${{ inputs.registry }}-

      - name: Crawl ${{ inputs.registry }}
        env:
          TURSO_DATABASE_URL: ${{ secrets.TURSO_DATABASE_URL }}
          TURSO_AUTH_TOKEN: ${{ secrets.TURSO_AUTH_TOKEN }}
        run: |
          case "${{ inputs.registry }}" in
            mcp-registry) MODULE=crawlers.mcp_registry ;;
            mcp-so) MODULE=crawlers.mcp_so ;;
            lobehub) MODULE=crawlers.lobehub ;;
          esac
          python -m $MODULE --output-dir data/${{ inputs.registry }}/
